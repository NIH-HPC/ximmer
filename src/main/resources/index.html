<!doctype html>
<!-- vim: set sw=4:ts=4:expandtab:cindent: -->
<%/*
    Groovy Template for Ximmer Main Index

        -   runDirectories  :  the directory containing all the runs
        
*/%>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Ximmer Report <%if(outputDirectory) { %>for <%=outputDirectory%> <% } %></title>
        
        <script type='text/javascript' src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.0.min.js'></script>
        <script type='text/javascript' src="http://cdn.datatables.net/1.10.0/js/jquery.dataTables.js"></script>
        <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/jquery-layout/1.3.0-rc-30.79/jquery.layout.min.js'></script>

        <link rel="stylesheet" href='http://cdn.datatables.net/1.10.0/css/jquery.dataTables.css'>
        
        <link rel="stylesheet" href='http://cdnjs.cloudflare.com/ajax/libs/jquery-layout/1.3.0-rc-30.79/layout-default.css'>
        
        ${assets}
        
        <style type='text/css'>
            .ui-tabs .ui-tabs-panel {
                padding: 0px 0px;
            }
            /* I can't figure out why scroll bars appear: for now, just hide overflow */
            .ui-layout-center.ui-layout-pane-center, .ui-layout-north.ui-layout-pane {
                overflow: hidden !important;
            }
        </style>

        <script type='text/javascript'>
        
            var events = {};
            
            var runs = <%=groovy.json.JsonOutput.toJson(runDirectories*.name)%>;
            
            var analysisName = "<%=analysisName%>";
            
            var simulationType = "<%=simulation_type%>";
        
            var layout = null;
            \$(document).ready(function() {
                
                \$('body').layout({ applyDefaultStyles: true });
                layout = \$('#innerLayout').layout({ applyDefaultStyles: true });
                layout.sizePane("north",50);
            });
            
            // Calling tabs() directly doesn't seem to work
            setTimeout(function() { 
                    \$('#innerLayout').tabs({
                            activate: function(event,ui) {
                                
                                console.log("Activate tab");
                                \$(events).trigger("activate",ui);
                                
                                if(!ui.newPanel[0]) {
                                    console.log("No new panel");
                                    return;
                                }
                                
                                \$('#maincenter').css('padding','0px');

                                var panelId = ui.newPanel[0].id;
                            }
                    });
           }, 0);
            
        </script>
    </head>
    <body>
        <div id='innerLayout' class='ui-layout-center'>
        
          <ul class='ui-layout-north'>
            <%if(enableTruePositives) { %>
                <li><a href="#simoverview">Overview</a></li>
                <li><a href="#simrocs">ROC Curves</a></li>
                <li><a href="#sample_counts">Sample Counts</a></li>
                <li><a href="#genome_dist">Position</a></li>
                <li><a href="#sizebreakdown">Size Breakdown</a></li>
                <li><a href="#qscorecalibration">Quality Score Calibration</a></li>
            <% } /* end if enableTruePositives */ %>
            
            <%runDirectories.eachWithIndex { File runDir, runIndex  -> %>
                <li><a href="#runcalls<%=runIndex%>" >Run <%=runIndex+1%></a>
            <%}%>
          </ul>
     
          <div class="ui-layout-center">
          
            <%if(enableTruePositives) { %>
                <div id=simoverview>
                    <%=summaryHTML%>
                </div> <!-- simoverview -->
                
                <div id=simrocs>
                    <h2>ROC Style Curves for <%=callers.size()%> CNV Callers</h2>
                    <p>ROC curves show the number of true positives vs false positives found
                       as quality score (or confidence measure) decreases.</p>
                       
                    <div id=cnv_roc_curve_container>
                        <svg id=cnv_roc_curve>
                        </svg>
                    </div>
                                           
                   <!-- old static image version of same thing
                    <img src="<%=analysisName%>_roc.png">
                    -->
                    
                </div><!-- simrocs -->
                
                <div id=sample_counts>
                    <h2>By Sample</h2>
                    <div id=cnvs_by_sample_chart_container>
                        <svg id=cnvs_by_sample_chart>
                        </svg>
                    </div>
                </div> <!-- sample_counts -->
                
                <div id=genome_dist>
                    <h2>Distribution Along Genome</h2>
                    <p>It is common that certain regions of the genome can present extreme difficulty in CNV calling and result in
                       clusters of false positives that undermine the results. Click anywhere in the main plot to zoom to the specific
                       chromosome in a sub-plot.
                    </p>
                    <div id=cnv_genome_dist_container>
                        <svg id=cnv_genome_dist>
                        </svg>
                        <svg id=cnv_chr_dist>
                        </svg> 
                    </div>
                </div>
              
                <div id=sizebreakdown>
                    <h2>Performance by Deletion Size</h2>
                    
                    <svg id=cnv_size_breakdown>
                    </svg>
                                    
                    <!-- 
                    <img src="<%=analysisName%>_sens_by_bp.png"> 
                    <img src="<%=analysisName%>_sens_by_seqbp.png"> 
                    <img src="<%=analysisName%>_sens_by_tg.png"> 
                     -->
                    
                </div> <!-- sizebreakdown -->
                
                <div id=qscorecalibration>
                    <h2>Quality Score Calibration Curves</h2>
                    <p>
                        These curves estimate the precision as quality varies for each CNV caller. Use these curves
                        to determine the appropriate level of filtering to control your false discovery rate.
                    </p>
                    <div id='qscore_calibration_figure'>
                    </div>
                    
                </div> <!-- qscore calibration -->
            <% } /* end if enableTruePositives */ %>
               
            <%runDirectories.eachWithIndex { File runDir, runIndex  -> %>
            <div id=runcalls<%=runIndex%> >
                <iframe id="run<%=runIndex%>Iframe" style="position: absolute; height: 100%; border: none" src="about:blank" width='100%' height='100%'></iframe>
            </div>             
            <%}%>
      </div> <% /* innerLayout */ %>
      <script type='text/javascript' src='cnv.js'></script>
    </body>
</html>